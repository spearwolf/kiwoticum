!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function a(a){return function(){return X.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===db(a)||a instanceof T}function d(a,b){if(Q&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(fb)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+fb+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===S&&d>=U&&kb>=d}function i(){if(Q)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return S=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return r(a)?a:s(a)?D(a):C(a)}function l(){function a(a){b=a,f.source=a,Z(c,function(b,c){W(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=ab(l.prototype),f=ab(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=Y(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):W(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&Q)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(C(c))},e.reject=function(c){b||a(B(c))},e.notify=function(a){b||Z(d,function(b,c){W(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return B(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=ab(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=B(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){!ib&&"undefined"!=typeof window&&window.console&&console.warn("[Q] Unhandled rejection reasons (should be empty):",gb),ib=!0}function x(){for(var a=0;a<gb.length;a++){var b=gb[a];console.warn("Unhandled rejection reason:",b)}}function y(){gb.length=0,hb.length=0,ib=!1,jb||(jb=!0,"undefined"!=typeof process&&process.on&&process.on("exit",x))}function z(a,b){jb&&(hb.push(a),gb.push(b&&"undefined"!=typeof b.stack?b.stack:"(no stack) "+b),w())}function A(a){if(jb){var b=$(hb,a);-1!==b&&(hb.splice(b,1),gb.splice(b,1))}}function B(a){var b=o({when:function(b){return b&&A(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return z(b,a),b}function C(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return cb(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function D(a){var b=l();return W(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function E(a){return o({isDef:function(){}},function(b,c){return K(a,b,c)},function(){return k(a).inspect()})}function F(a,b,c){return k(a).spread(b,c)}function G(a){return function(){function b(a,b){var g;if(eb){try{g=d[a](b)}catch(h){return B(h)}return g.done?g.value:p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?h.value:B(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function H(a){k.done(k.async(a)())}function I(a){throw new T(a)}function J(a){return function(){return F([this,L(arguments)],function(b,c){return a.apply(b,c)})}}function K(a,b,c){return k(a).dispatch(b,c)}function L(a){return p(a,function(a){var b=0,c=l();return Z(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function M(a){return p(a,function(a){return a=_(a,k),p(L(_(a,function(a){return p(a,V,V)})),function(){return a})})}function N(a){return k(a).allSettled()}function O(a,b){return k(a).then(void 0,void 0,b)}function P(a,b){return k(a).nodeify(b)}var Q=!1;try{throw new Error}catch(R){Q=!!R.stack}var S,T,U=i(),V=function(){},W=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(W=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return W}(),X=Function.call,Y=a(Array.prototype.slice),Z=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),$=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),_=a(Array.prototype.map||function(a,b){var c=this,d=[];return Z(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),ab=Object.create||function(a){function b(){}return b.prototype=a,new b},bb=a(Object.prototype.hasOwnProperty),cb=Object.keys||function(a){var b=[];for(var c in a)bb(a,c)&&b.push(c);return b},db=a(Object.prototype.toString);T="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var eb;try{new Function("(function* (){ yield 1; })"),eb=!0}catch(R){eb=!1}var fb="From previous event:";k.resolve=k,k.nextTick=W,k.longStackSupport=!1,k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):a.resolve(arguments.length>2?Y(arguments,1):c)}},k.promise=m,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return B(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return B(c)}}return B(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return W(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var gb=[],hb=[],ib=!1,jb=!0;k.resetUnhandledRejections=y,k.getUnhandledReasons=function(){return gb.slice()},k.stopUnhandledRejectionTracking=function(){y(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",x),jb=!1},y(),k.reject=B,k.fulfill=C,k.master=E,k.spread=F,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=G,k.spawn=H,k["return"]=I,k.promised=J,k.dispatch=K,o.prototype.dispatch=function(a,b){var c=this,d=l();return W(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,Y(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,Y(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,Y(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},k.fbind=function(a){var b=k(a),c=Y(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(Y(arguments))])}},o.prototype.fbind=function(){var a=this,b=Y(arguments);return function(){return a.dispatch("apply",[this,b.concat(Y(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=L,o.prototype.all=function(){return L(this)},k.allResolved=j(M,"allResolved","allSettled"),o.prototype.allResolved=function(){return M(this)},k.allSettled=N,o.prototype.allSettled=function(){return this.then(function(a){return L(_(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=O,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){W(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){c.reject(new Error(b||"Timed out after "+a+" ms"))},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=Y(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=Y(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=Y(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=Y(arguments,1);return function(){var c=b.concat(Y(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=Y(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=Y(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(Y(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=Y(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=Y(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=Y(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=Y(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=P,o.prototype.nodeify=function(a){return a?void this.then(function(b){W(function(){a(null,b)})},function(b){W(function(){a(b)})}):this};var kb=i();return k}),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var Stats=function(){var a=Date.now(),b=a,c=0,d=1/0,e=0,f=0,g=1/0,h=0,i=0,j=0,k=document.createElement("div");k.id="stats",k.addEventListener("mousedown",function(a){a.preventDefault(),s(++j%2)},!1),k.style.cssText="width:80px;opacity:0.9;cursor:pointer";var l=document.createElement("div");l.id="fps",l.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",k.appendChild(l);var m=document.createElement("div");m.id="fpsText",m.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="FPS",l.appendChild(m);var n=document.createElement("div");for(n.id="fpsGraph",n.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff",l.appendChild(n);74>n.children.length;){var o=document.createElement("span");o.style.cssText="width:1px;height:30px;float:left;background-color:#113",n.appendChild(o)}var p=document.createElement("div");p.id="ms",p.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",k.appendChild(p);var q=document.createElement("div");q.id="msText",q.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",q.innerHTML="MS",p.appendChild(q);var r=document.createElement("div");for(r.id="msGraph",r.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0",p.appendChild(r);74>r.children.length;)o=document.createElement("span"),o.style.cssText="width:1px;height:30px;float:left;background-color:#131",r.appendChild(o);var s=function(a){switch(j=a){case 0:l.style.display="block",p.style.display="none";break;case 1:l.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:k,setMode:s,begin:function(){a=Date.now()},end:function(){var j=Date.now();c=j-a,d=Math.min(d,c),e=Math.max(e,c),q.textContent=c+" MS ("+d+"-"+e+")";var k=Math.min(30,30-30*(c/200));return r.appendChild(r.firstChild).style.height=k+"px",i++,j>b+1e3&&(f=Math.round(1e3*i/(j-b)),g=Math.min(g,f),h=Math.max(h,f),m.textContent=f+" FPS ("+g+"-"+h+")",k=Math.min(30,30-30*(f/100)),n.appendChild(n.firstChild).style.height=k+"px",b=j,i=0),j},update:function(){a=this.end()}}};!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.papa=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){!function(){"use strict";b.exports=a("./papa/papa"),a("./papa/factory"),a("./papa/events"),a("./papa/app")}()},{"./papa/app":2,"./papa/events":5,"./papa/factory":6,"./papa/papa":7}],2:[function(a){!function(){var b=a("./papa");a("./factory"),a("./app_state_machine.coffee"),b.Module("App",function(){function a(){return"app"+e++}function c(a){var c=b.Factory.Create(["app_state_machine"],!0);return c.papa.name=a,c}var d={},e=0,f=function(b,e){if(1===arguments.length){if("string"==typeof arguments[0])return d[b];e=b,b=a()}var f=c(b);return d[b]=f,e(f),f};return f})}()},{"./app_state_machine.coffee":3,"./factory":6,"./papa":7}],3:[function(a){var b,c;b=a("./papa"),a("./factory"),a("./events"),c=a("./coffee_state_machine").state_machine,b.Factory("app_state_machine",function(){return{namespace:"state",dependsOn:"events",initialize:function(a,b){return c("state",{extend:a},function(c,d,e){return c.initial("created"),c("setup",{parent:"initialize"}),c("loading",{parent:"initialize"}),c("postInit",{parent:"initialize"}),c("running",{parent:"ready"}),c("paused",{parent:"ready"}),d("start",function(){return e.from("created",{to:"setup"},function(){return b.emit("setup")}),e.from("postInit",{to:"running"},function(){return b.emit("started")})}),d("loadAssets",function(){return e.from("setup",{to:"loading"})}),d("assetsLoaded",function(){return e.from("loading",{to:"postInit"},function(){return b.emit("assetsLoaded"),a.start()})})})}}})},{"./coffee_state_machine":4,"./events":5,"./factory":6,"./papa":7}],4:[function(b,c,d){(function(){var b,c,e=[].slice,f={}.hasOwnProperty;c=function(a,b,c){var d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K;for("function"==typeof b&&"undefined"==typeof c&&(J=[b,{}],c=J[0],b=J[1]),B="function"==typeof b["class"]?new b["class"]:null!=(K=b.extend)?K:{},g={},F={},l=function(a,b){var c;return c=g[a]||(g[a]={state:a}),null!=b&&(c.parent=b),c},d=function(a,b,c){var d,e,f,g,h;for("string"==typeof b&&(b=[b]),h=[],f=0,g=b.length;g>f;f++)d=b[f],e=F[d]||(F[d]={}),e[a]||(e[a]=[]),h.push(e[a].push(c));return h},E=function(a,b,c){var e,f;return null==b&&(b={}),"function"==typeof b&&(f=[b,{}],c=f[0],b=f[1]),e=l(a,b.parent),"function"==typeof c&&(e.properties=c.call(B)),null!=b.parent&&l(b.parent),null!=b.enter&&d("enter",a,b.enter),null!=b.exit?d("exit",a,b.exit):void 0},E.initial=function(b,c,d){return null==c&&(c={}),E(b,c,d),B[a]=b},E.type="coffee_state_machine.StateHelperFunction",B.is_valid_state=function(a){return null!=g[a]&&g[a].state===a},m=function(a){return function(){var b,c,f;return c=2<=arguments.length?e.call(arguments,0,f=arguments.length-1):(f=0,[]),b=arguments[f++],d(a,c,b)}},E.enter=m("enter"),E.exit=m("exit"),C={},w=function(a){var b;return null!=(b=g[a])?b.parent:void 0},x=function(a){var b;return(b=null!=g[a])?b.parents||(b.parents=function(){var b;for(b=[];a=w(a);)b.push(a);return b}().reverse()):[]},B.get_parent_states=function(a){return x(a)},B.is_state=function(b){var c;return c=B[a],c===b||x(c).indexOf(b)>=0},v=function(a,b){var c,d,e;for(e=x(a),c=0,d=e.length;d>c;c++)a=e[c],b(a)},i=function(a,b){var d,e,f,g,h;for(d=(null!=(g=F[a])?g[b]:void 0)||[],h=[],e=0,f=d.length;f>e;e++)c=d[e],h.push(c.call(B));return h},t=function(a){var b,c,d;for(b in a)f.call(a,b)&&(c=a[b],d=[B[b],c],C[b]=d[0],B[b]=d[1])},u=function(a,b){var c,d;for(c in a)f.call(a,c)&&(d=a[c],b[c]=d)},D=function(b,c){var d,e,h,j,k,l,m,n,o,p,q;for(null==c&&(c=B[a]),h={old:x(c),next:x(b)},h.exit=function(){var a,b,c,d;for(c=h.old,d=[],a=0,b=c.length;b>a;a++)j=c[a],-1===h.next.indexOf(j)&&d.push(j);return d}(),h.enter=function(){var a,b,c,d;for(c=h.next,d=[],a=0,b=c.length;b>a;a++)j=c[a],-1===h.old.indexOf(j)&&d.push(j);return d}(),p=h.exit,l=0,n=p.length;n>l;l++)j=p[l],j!==b&&i(j,"exit");null!=c&&b!==c&&-1===h.next.indexOf(c)&&i(c,"exit"),B[a]=b;for(d in C)f.call(C,d)&&(k=C[d],B[d]=k);for(e={},v(b,function(a){return u(g[a].properties,e)}),u(g[b].properties,e),t(e),q=h.enter,m=0,o=q.length;o>m;m++)j=q[m],j!==c&&i(j,"enter");return c!==!1&&b===c||-1!==h.old.indexOf(b)?void 0:i(b,"enter")},h=function(a,b,c,d){return"function"==typeof b&&(a["if"]=b),"function"==typeof c&&(a.unless=c),"function"==typeof d&&(a.action=d),a},n=function(a,b,c,d,e){var f;return f={from:a,to:b},h(f,c,d,e)},A=function(a){return null!=a?"string"==typeof a?[a]:a:[]},k=function(a,b,c,d,e,f){var g;return g={to:a,except:A(b),only:A(c),is_valid:function(a){return null!=a?(!this.toState||this.toState===a)&&(0===this.except.length||this.except.indexOf(a)<0)&&(0===this.only.length||this.only.indexOf(a)>=0):void 0}},h(g,d,e,f)},r=function(){var a;return(a=B[q]).transitions||(a.transitions={})},p=function(){var a;return(a=B[q]).all_transitions||(a.all_transitions=[])},o=function(a,b){var c,d,e,f;e=r(),f=[];for(c in a)d=a[c],f.push(e[c]=n(c,d,void 0,void 0,b));return f},G=function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],"undefined"!=typeof q&&null!==q&&"object"==typeof a[0]?o(a[0],a[1]):void 0},G.from=function(a,b,c){var d,e,f,g,h,i;if("undefined"!=typeof q&&null!==q){for(e=r(),i="string"==typeof a?[a]:a,h=[],f=0,g=i.length;g>f;f++)d=i[f],h.push(e[d]=n(d,b.to,b["if"],b.unless,c||b.action));return h}},G.all=function(a,b){var c;return null==a&&(a={}),null==b&&(b=void 0),"undefined"!=typeof q&&null!==q?(c=p(),c.push(k(a.to,a.except,a.only,a["if"],a.unless,b||a.action))):void 0},G.type="coffee_state_machine.TransitionHelperFunction",z=[],q=null,j=function(a){return!(null!=a["if"]&&!a["if"].call(B)||null!=a.unless&&a.unless.call(B))},s=function(b,c){var d,f;return d=B[b]||(B[b]=function(){var b,c,f,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v;if(c=1<=arguments.length?e.call(arguments,0):[],f=B[a],l=(d.transitions||(d.transitions={}))[f],null==l||j(l)||(l=null),null==l)for(u=d.all_transitions||(d.all_transitions=[]),o=0,r=u.length;r>o;o++)if(b=u[o],b.is_valid(f)&&j(b)){l=b;break}if(null!=l){for(h=f,D(l.to),f=B[a],m=[],v=x(h),p=0,s=v.length;s>p;p++)i=v[p],k=d.transitions[i],null!=k&&null!=k.action&&(k.to===f||-1!==x(f).indexOf(k.to))&&m.push(k.action);for(null!=l.action&&m.push(l.action),n=[],q=0,t=m.length;t>q;q++)g=m[q],-1===n.indexOf(g)&&(g.apply(B,[h].concat(c)),n.push(g));return!0}return!1}),"function"==typeof c&&(q=b,c.call(B),q=null),f={transition:function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],z.push({fn:G,event:b,args:a}),f}},f.transition.from=function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],z.push({fn:G.from,event:b,args:a}),f},f.transition.all=function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],z.push({fn:G.all,event:b,args:a}),f},f},s.type="coffee_state_machine.EventHelperFunction",c.call(B,E,s,G),H=0,I=z.length;I>H;H++)y=z[H],q=y.event,y.fn.apply(this,y.args);return q=null,B[a]||(B[a]=b.initial),E(B[a]),D(B[a],!1),B},"function"==typeof a&&a.amd?a("state_machine",function(){return c}):(b="undefined"!=typeof d&&null!==d?d:this,b.state_machine=c)}).call(this)},{}],5:[function(a){!function(){var b=a("./papa");a("./factory"),b.Factory("events",function(){return function(a,b){var c={_id:0};a.on=function(a,b,d){2===arguments.length&&(d=b,b=0);var e=c[a]||(c[a]=[]),f=++c._id;return e.push({id:f,fn:d,prio:b||0}),e.sort(function(a,b){return b.prio-a.prio}),f},a.off=function(a){var b,d,e;for(b in c)if(c.hasOwnProperty(b))for(d=0;d<c[b].length;d++)if(e=c[b][d],e.id===a)return void c[b].splice(d,1)},a.emit=function(a){var d=Array.prototype.slice.call(arguments,1);a in c&&c[a].forEach(function(a){a.fn.apply(b,d)})}}})}()},{"./factory":6,"./papa":7}],6:[function(a){!function(){var b=a("./papa");b.Module("Factory",function(){function a(a,e){var f,g=e;e.papa&&e.papa.instance&&(g=e.papa.instance);var h=c[a];if(Array.isArray(h)&&h.length>0){if(e.papa||(e.papa={}),e.papa.mixins){if(e.papa.mixins.indexOf(a)>-1)return;e.papa.mixins.push(a)}else e.papa.mixins=[a];h.forEach(function(a){"function"==typeof a?a(e,g):"object"==typeof a&&(Array.isArray(a.dependsOn)?a.dependsOn.forEach(function(a){d.Include(a,e)}):"string"==typeof a.dependsOn&&d.Include(a.dependsOn,e),"function"==typeof a.initialize&&("string"==typeof a.namespace?(f=b.Module.CreateObjPath(a.namespace,e),a.initialize(f,g)):a.initialize(e,g)))})}}var c={},d=function(a,b){Array.isArray(c[a])||(c[a]=[]),c[a].push(b())};return d.Include=function(b,c){return Array.isArray(b)?b.forEach(function(b){a(b,c)}):a(b,c),c},d.Create=function(a,b,c){if(b){var e=c||{};e.papa={};var f=Object.create(e);return e.papa.instance=f,e.papa.apiInstance=e,a&&d.Include(a,e),f}return d.Include(a,c||{})},d})}()},{"./papa":7}],7:[function(a,b){!function(a){"use strict";a.Module=function(b,c,d){2===arguments.length&&(d=c,c=a),a.Module.CreateObjPath(b,c,function(a,c){if("function"==typeof d){"undefined"==typeof a[c]&&(a[c]={});var e=d(a[c]);"undefined"!=typeof e&&(a[c]=e)}else{if("undefined"!=typeof a[c])throw new Error("could not override object path: "+b);a[c]=d}})},a.Module.CreateObjPath=function(a,b,c){var d,e,f=a.split("."),g=b;for(d=0;d<f.length-1;d++)e=f[d],"undefined"==typeof g[e]&&(g[e]={}),g=g[e];return e=f[f.length-1],"function"!=typeof c?("undefined"==typeof g[e]&&(g[e]={}),g[e]):void c(g,e)}}(b.exports)},{}]},{},[1])(1)}),function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){!function(){"use strict";a("./kiwoticum/main"),kiwoticum.main()}()},{"./kiwoticum/main":3}],2:[function(){papa.Module("kiwoticum.json",window,function(a){a.load=function(a){var b,c;return b=Q.defer(),c=new XMLHttpRequest,c.open("GET",a,!0),c.onload=function(){return c.status>=200&&c.status<400?b.resolve(JSON.parse(c.responseText)):console.log("ERROR",c)},c.onerror=function(){return console.log("ERROR",c)},c.send(),b.promise}})},{}],3:[function(a){!function(){"use strict";a("./json/load.coffee"),a("./world/create.coffee"),papa.Module("kiwoticum",window,function(a){a.main=function(){a.json.load("/api/v1/create").then(function(b){var c=a.world.create(b);console.log("world",c),console.log("region#0 centerPoint",c.regions[0].centerPoint),console.log("region#0",c.regions[0])})}})}()},{"./json/load.coffee":2,"./world/create.coffee":4}],4:[function(a){a("./setup.coffee"),papa.Module("kiwoticum.world",window,function(a){a.create=function(a){return papa.Factory.Create("kiwoticum.world",!0,{data:a})}})},{"./setup.coffee":8}],5:[function(a){var b,c;a("./region.coffee"),c=function(a,b){var c,d,e,f;for(c=null,e=0,f=b.length;f>e;e++)d=b[e],(null===c||d[a]<c)&&(c=d[a]);return c},b=function(a,b){var c,d,e,f;for(c=null,e=0,f=b.length;f>e;e++)d=b[e],(null===c||d[a]>c)&&(c=d[a]);return c},papa.Factory("kiwoticum.world.region.bbox",function(){return{dependsOn:"kiwoticum.world.region",initialize:function(a,d){return d.bbox={x0:c("x",d.path.full),y0:c("y",d.path.full),x1:b("x",d.path.full),y1:b("y",d.path.full)},d.bbox.w=d.bbox.x1-d.bbox.x0,d.bbox.h=d.bbox.y1-d.bbox.y0}}})},{"./region.coffee":7}],6:[function(a){a("./region.coffee"),a("./bbox.coffee"),papa.Module("kiwoticum.world.region",window,function(a){a.create=function(a,b){return papa.Factory.Create(["kiwoticum.world.region","kiwoticum.world.region.bbox"],!0,{world:a,id:b})}})},{"./bbox.coffee":5,"./region.coffee":7}],7:[function(){papa.Factory("kiwoticum.world.region",function(){return{initialize:function(a,b){return b.centerPoint=b.world.data.centerPoints[b.id],b.path={base:b.world.data.regions[b.id].basePath,full:b.world.data.regions[b.id].fullPath}}}})},{}],8:[function(a){a("./region/create.coffee"),papa.Factory("kiwoticum.world",function(){return{initialize:function(a,b){var c,d;return c=function(a){return kiwoticum.world.region.create(b,a)},b.regions=function(){var a,e,f;for(f=[],d=a=0,e=b.data.regions.length;e>=0?e>a:a>e;d=e>=0?++a:--a)f.push(c(d));return f}()}}})},{"./region/create.coffee":6}]},{},[1,3,2,4,5,6,7,8]);