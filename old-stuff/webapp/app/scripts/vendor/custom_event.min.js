// ============================================================
// custom_event.js -- https://github.com/spearwolf/custom_event
// ============================================================
//
// Created at 2010/05/07
// Copyright (c) 2010-2013 Wolfger Schramm <wolfger@spearwolf.de>
//
// Permission is hereby granted, free of charge, to any person obtaining a copy of
// this software and associated documentation files (the "Software"), to deal in
// the Software without restriction, including without limitation the rights to
// use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
// the Software, and to permit persons to whom the Software is furnished to do so,
// subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
// COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
// IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
//
!function(){function a(a,b){this.message=a||"unknown reason",this.name=b||"CustomEventError"}function b(a,b){a||(a=b?"":"/"),"/"===a[0]?(this.path=a,this.isAbsolute=!0):b?(this.node=b,this.path=a,this.isAbsolute=!1):(this.isAbsolute=!0,this.path="/"+a)}function c(a,b){for(var c;c=b.shift();){if(!(c in a))return;a=a[c]}return"function"==typeof a?a:void 0}function d(a,b){var d=typeof b,e="object"===d,g={id:k++,node:a,type:"CustomEventListener",actionType:d,isDeepListener:e,action:b,isPaused:!1};return g.setPause=function(a){g.isPaused=!!a},"function"===d?g.callAction=function(a,c){g.isPaused||a||(c?b.apply(f,c):b.apply(f))}:"object"===d?g.callAction=function(a,d){if(!g.isPaused&&a){var e=c(b,a);e&&(d?e.apply(b,d):e.apply(b))}}:(i.error("unsupported listener action type:",d),g.callAction=function(){}),e?a.deepListener.push(g):a.listener.push(g),g.destroy=function(){var b=e?a.deepListener:a.listener,c=b.indexOf(g);c>=0&&b.splice(c,1);for(var d in g)g.hasOwnProperty(d)&&delete g[d]},g}function e(c,f){function g(a){return"string"==typeof a?new b(a,o):a}function i(a){for(var b,c=a.pathItems(),d=o;(b=c.shift())&&(d=d.getChild(b)););return d}function k(a){for(var b,c,d=a.pathItems(),e=o;b=d.shift();)c=e.getChild(b),c||(c=e.addChild(b)),e=c;return e}function l(a,b){var c,d,e,f=a.pathItems(),g=o;for(b&&(e=[{node:g,restPathItems:f.slice(0)}]);c=f.shift();){if(d=g.getChild(c),!d){f.splice(0,0,c);break}g=d,b&&g.listener.length>0&&e.push({node:g,restPathItems:f.length>0?f.slice(0):void 0})}return{node:g,restPathItems:f.length>0?f:void 0,visitedNodes:e}}function m(a,b,c){return function(d){return d=g(d),c&&(d=d.absolutePath()),d.isAbsolute?o.isRootNode?b(d,c):o.rootNode[a](d,c):o===d.node?b(d):d.node[a](d)}}var n={},o=function(a,b){var c=o.findOrCreate(g(a)),d=[],e={isPaused:!1,setPause:function(a){return e.isPaused=!!a,d.forEach(function(b){b.setPause(a)}),e.emit=e.isPaused?function(){}:c.emit,e.isPaused},off:function(){return e.setPause(!0)},on:function(a,b){if(0===arguments.length)return e.setPause(!1);var f=c.on(a,b);return f.setPause(e.isPaused),d.push(f),f},emit:c.emit,destroy:function(){d.forEach(function(a){"function"==typeof a.destroy&&a.destroy()}),d=[]},mod:c};return"function"==typeof b&&b.call(e,e),e};return o.type="CustomEventNode",o.nodeName=c,o.isRootNode=!f,o.parentNode=f,o.rootNode=h,o.listener=[],o.deepListener=[],o.path=function(){if(o.isRootNode)return void 0;var a="/"+o.nodeName;return f!==o.rootNode&&(a=f.path.toString()+a),new b(a,o)}(),o.addChild=function(b){if(n[b])throw new a("addChild: nodeName should be unique: "+b);var c=e(b,o);return n[b]=c,c},o.getChild=function(a){return n[a]},o.find=m("find",i),o.match=m("match",l),o.deepMatch=m("deepMatch",l,!0),o.findOrCreate=m("findOrCreate",k),o.createEventListener=function(a){return d(o,a)},o.on=function(a,b){return o.findOrCreate(a).createEventListener(b)},o.forEachListener=function(a){o.listener.forEach(a),o.deepListener.forEach(a)},o.emit=function(a){-1!==j&&(j?j++:j=1);var b=null;arguments.length>1&&(b=Array.prototype.slice.call(arguments,1)),o.deepMatch(a).visitedNodes.forEach(function(a){a.node.forEachListener(function(c){c.callAction(a.restPathItems,b)})}),0>j?j=0:(j&&j--,j||(j=-1,h.emit("__CustomEventCallStackEnd__")))},o}var f=this,g={VERSION:"0.8.0"};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=g),exports._e=g):"function"==typeof define&&define.amd?(define("custom_event",function(){return g}),define("custom_event/global",function(){return f._e=g,g})):f._e=g;var h,i=function(){var a="undefined"!=typeof f.console&&"function"==typeof Function&&"function"==typeof Function.prototype.bind,b=a&&"function"==typeof f.console.group,c="custom_event.js:",d={node_env:"undefined"==typeof window},e=a?function(a){return Function.prototype.bind.call(console[a],console)}:void 0,h=a?e("error"):null,i=a?e("log"):null,j=a?e("log"):null,k=b?e("group"):null,l="";return a?(d.error=function(){h.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.debug=function(){g.options.debug&&i.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.trace=function(){g.options.trace&&j.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},b?(d.debugGroup=function(){g.options.debug&&k.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.debugGroupEnd=function(){g.options.debug&&console.groupEnd()},d.traceGroup=function(){g.options.trace&&k.apply(console,[l+c].concat(Array.prototype.slice.call(arguments)))},d.traceGroupEnd=function(){g.options.trace&&console.groupEnd()}):(d.debugGroup=function(){g.options.debug&&(i.apply(f,[l+c].concat(Array.prototype.slice.call(arguments))),l+="    ")},d.traceGroup=function(){g.options.trace&&(j.apply(f,[l+c].concat(Array.prototype.slice.call(arguments))),l+="    ")},d.traceGroupEnd=d.debugGroupEnd=function(){l=l.substr(0,l.length-4)})):d.error=d.debug=d.trace=d.traceGroup=d.traceGroupEnd=function(){},d}(),j=0;a.prototype.toString=function(){return this.name+": "+this.message},b.prototype.toString=function(){return this.path},b.prototype.pathItems=function(){for(var a=this.path.split("/"),b=[],c=0;c<a.length;c++)a[c]&&b.push(a[c]);return b},b.prototype.absolutePath=function(){if(this.isAbsolute)return this;if(this.node){for(var c=[this.node.nodeName].concat(this.pathItems()),d=this.node.parentNode;d;)d.isRootNode||c.splice(0,0,d.nodeName),d=d.parentNode;return new b("/"+c.join("/"))}throw new a("NodePath.absolutePath: relative path without node")};var k=1;h=e(),g.log=i,g.rootNode=h,g.NodePath=b,g.on=h.on,g.emit=h.emit,g.mod=h}();